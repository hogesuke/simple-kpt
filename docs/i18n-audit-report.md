# 多言語化 最終チェック結果

調査日: 2026-02-05

---

## 1. ハードコードされた日本語テキスト

**状態: 重大な問題あり - 37箇所**

### src/lib/kpt-api.ts（30箇所）

APIレイヤーのエラーメッセージがハードコードされています：

| 行番号   | メッセージ                              |
| -------- | --------------------------------------- |
| 74       | `'ボードリストの取得に失敗しました'`    |
| 107      | `'ボードの取得に失敗しました'`          |
| 143, 147 | `'ボードの作成に失敗しました'`          |
| 168      | `'アイテム一覧の取得に失敗しました'`    |
| 189, 193 | `'アイテムの作成に失敗しました'`        |
| 227, 231 | `'アイテムの更新に失敗しました'`        |
| 247      | `'アイテムの削除に失敗しました'`        |
| 262      | `'プロフィールの取得に失敗しました'`    |
| 286, 290 | `'プロフィールの更新に失敗しました'`    |
| 311      | `'メンバー一覧の取得に失敗しました'`    |
| 329, 333 | `'ボードへの参加に失敗しました'`        |
| 349      | `'ボードの削除に失敗しました'`          |
| 365, 369 | `'ボード名の更新に失敗しました'`        |
| 420      | `'Tryアイテム一覧の取得に失敗しました'` |
| 473, 477 | `'タイマーの開始に失敗しました'`        |
| 493, 497 | `'タイマーの停止に失敗しました'`        |
| 519      | `'所有ボードの取得に失敗しました'`      |
| 539      | `'アカウントの削除に失敗しました'`      |
| 559, 563 | `'投票に失敗しました'`                  |
| 615      | `'統計データの取得に失敗しました'`      |
| 645      | `'サマリーの生成に失敗しました'`        |

### src/stores/（3箇所）

| ファイル             | メッセージ                               |
| -------------------- | ---------------------------------------- |
| useHomeStore.ts:90   | `'ボードリストの読み込みに失敗しました'` |
| useBoardStore.ts:95  | `'ボードへの参加に失敗しました'`         |
| useBoardStore.ts:133 | `'ボードの読み込みに失敗しました'`       |

### src/hooks/（3箇所）

| ファイル             | メッセージ                         |
| -------------------- | ---------------------------------- |
| useDeleteBoard.ts:25 | `'ボードの削除に失敗しました'`     |
| useItemActions.ts:29 | `'カードの削除に失敗しました'`     |
| useItemActions.ts:40 | `'カード位置の更新に失敗しました'` |

---

## 2. 未使用の翻訳キー

**状態: 96件の未使用キー**

多くのキーが辞書に存在するが、コード内で`t()`経由で呼び出されていません。

### カテゴリ別一覧

#### UI汎用（ui.json）

- `保存`, `キャンセル`, `削除`, `閉じる`, `確認`, `次へ`, `フィルター`, `クリア`, `コピー`, `共有`, `エラー`, `成功`, `情報`, `必須`, `匿名ユーザー`, `すべて`, `変更`, `再読み込み`, `言語を選択`

#### ナビゲーション/メニュー（board.json）

- `ログイン`, `ログアウト`, `ボード`, `説明`, `最終更新`, `ボード一覧`, `メンバー一覧`, `アイテムを削除`, `投票`

#### タイマー関連（board.json）

- `停止`, `リセット`, `1分`, `3分`, `5分`, `10分`, `カスタム`, `時間になりました`, `残り{{time}}`

#### 投票テンプレート（board.json）

- `{{count}}票`, `投票者`, `「{{text}}」に投票する`, `「{{text}}」の投票を取り消す`

#### エクスポート（board.json）

- `{{count}}件のカードをエクスポートします`

#### バリデーション（validation.json）

- 全14キー（動的に使用されている可能性あり）

#### エラーメッセージ（error.json）

- `エラーが発生しました`, `ページが見つかりません`, `セッションが切れました。再度ログインしてください。` など多数

#### デモ/ランディング（landing.json）

- `チームの振り返りを\nもっとシンプルに`, `デモユーザー1-3`, `デモKeep1-3`, `デモProblem1-2`, `デモTry1-2`, `デモボード`, `本日の利用上限に達しました`

**注記:** これらは動的キー生成で使用されている可能性があるため、個別確認が必要です。

---

## 3. 翻訳の欠落

**状態: 問題なし ✅**

全291キーが日英両方に存在し、完全に対称です。

---

## 4. 言語セレクタのアクセシビリティ

**状態: 軽微な改善余地あり**

### 良い点

- `aria-label={i18n.t('ui:言語を選択')}` が設定されている
- Globeアイコンに`aria-hidden="true"`
- Radix UIのDropdownMenuRadioGroupを使用（キーボードナビゲーション対応）

### 問題点

`src/components/layout/LanguageSelector.tsx`

```typescript
const languageLabels: Record<SupportedLanguage, string> = {
  ja: '日本語',
  en: 'English',
};
```

言語名がハードコードされている。これは意図的な可能性もあります（言語名は常にその言語で表示するのが一般的なため）。

---

## 5. 日付・時刻フォーマット

**状態: 一部問題あり**

### 正しく実装されている箇所

- `BoardTableRow.tsx` - `i18n.language`でロケール選択
- `ItemDetailPanel.tsx` - date-fnsのlocaleを使用

### 問題のある箇所

**src/lib/export-helpers.ts**

`'ja-JP'`がハードコードされている：

```typescript
// Line 32
function formatDateTime(dateString: string | undefined): string {
  return date.toLocaleString('ja-JP', { ... })
}

// Line 47
function formatDate(dateString: string | null | undefined): string {
  return date.toLocaleDateString('ja-JP', { ... })
}
```

---

## 6. 数値フォーマット

**状態: 不完全**

**src/components/shadcn/chart.tsx:209**

```typescript
{
  item.value.toLocaleString();
}
```

`.toLocaleString()`がロケール指定なしで使用（ブラウザデフォルトに依存）

---

## 7. ドキュメントタイトル

**状態: 良好 ✅**

全ページで`t()`を使用して翻訳されています。

### 軽微な問題

**src/pages/KPTBoard.tsx:179**

```typescript
<title>{board?.name ? `${board.name} - Simple KPT` : 'KPT Board - Simple KPT'}</title>
```

フォールバック`'KPT Board - Simple KPT'`が翻訳対象外

---

## 8. HTMLのlang属性

**状態: 良好 ✅**

`src/i18n/index.ts`で言語変更時に`document.documentElement.lang`が更新されています。

```typescript
document.documentElement.lang = i18n.language;
i18n.on('languageChanged', (lng) => {
  document.documentElement.lang = lng;
});
```

---

## 重要度別サマリー

| 重要度   | 項目                                              | 件数   |
| -------- | ------------------------------------------------- | ------ |
| **重大** | APIレイヤー等のハードコードされたエラーメッセージ | 37箇所 |
| **重大** | export-helpersのロケールハードコード              | 2箇所  |
| **高**   | 未使用の翻訳キー                                  | 96件   |
| **中**   | 言語セレクタの言語名ハードコード                  | 1箇所  |
| **中**   | chart.tsxの数値フォーマット                       | 1箇所  |
| **低**   | KPTBoardタイトルのフォールバック                  | 1箇所  |

---

## 推奨対応

### 重大（必須）

1. `src/lib/kpt-api.ts`のエラーメッセージを翻訳キーに置き換える
2. `src/stores/`と`src/hooks/`のエラーメッセージを翻訳キーに置き換える
3. `src/lib/export-helpers.ts`のロケールを動的に取得するように修正

### 高（推奨）

1. 未使用の翻訳キーを精査し、不要なものを削除

### 中（検討）

1. 言語セレクタの言語名をどう扱うか決定
2. chart.tsxの数値フォーマットにロケール指定を追加

### 低（任意）

1. KPTBoardのタイトルフォールバックを翻訳対象に
